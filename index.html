<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mural das Conquistas</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Orbitron (Cyberpunk Style) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Icon Library for lock icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilo customizado para a fonte e tema Cyberpunk */
        body {
            font-family: 'Orbitron', sans-serif;
            background-color: #0d0221;
            background-image: 
                linear-gradient(rgba(13, 2, 33, 0.95), rgba(13, 2, 33, 0.95)),
                url('https://www.transparenttextures.com/patterns/clean-gray-paper.png');
            color: #f0f0f0;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Efeito de neon para textos */
        .neon-text-cyan {
            text-shadow: 0 0 5px #2dd4bf, 0 0 10px #2dd4bf, 0 0 15px #2dd4bf;
        }
        .neon-text-magenta {
            text-shadow: 0 0 5px #d946ef, 0 0 10px #d946ef, 0 0 15px #d946ef;
        }

        /* Estilo dos cards das conquistas */
        .badge-card {
            background-color: rgba(41, 22, 79, 0.5);
            border: 1px solid #a78bfa;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease-in-out;
            box-shadow: 0 0 15px rgba(167, 139, 250, 0.2);
        }
        .badge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(167, 139, 250, 0.5);
            border-color: #c4b5fd;
        }

        /* Estilo do emblema principal no card */
        .badge-main-img {
            transition: all 0.3s ease-in-out;
            border-radius: 50%;
            object-fit: cover;
        }
        .badge-card:hover .badge-main-img {
            transform: scale(1.1);
        }
        
        /* Estilo dos formulários */
        select, button, input {
            background-color: rgba(17, 24, 39, 0.8);
            border: 1px solid #6366f1;
            color: #f0f0f0;
        }
        select:focus, button:focus, input:focus {
            outline: none;
            box-shadow: 0 0 10px #6366f1;
            border-color: #818cf8;
        }
        button:hover {
            background-color: #4f46e5;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

    <!-- Botão de Acesso do Administrador -->
    <div class="absolute top-4 right-4">
        <button id="admin-login-btn" title="Área do Professor" class="text-violet-400 hover:text-cyan-300 transition-colors">
            <i class="fas fa-lock fa-2x"></i>
        </button>
    </div>

    <div class="container mx-auto p-4 md:p-8">

        <!-- Cabeçalho -->
        <header class="text-center mb-12">
            <h1 class="text-5xl font-bold text-cyan-400 neon-text-cyan">Mural das Conquistas</h1>
            <p class="text-violet-300 mt-4 text-lg">UM RECONHECIMENTO À EVOLUÇÃO DOS NOSSOS CYBER-ESTUDANTES</p>
        </header>

        <!-- Painel de Controle (agora oculto por padrão) -->
        <div id="admin-panel" class="hidden bg-gray-900/50 border border-violet-700 p-6 rounded-xl shadow-lg shadow-violet-500/10 mb-12 max-w-2xl mx-auto backdrop-blur-sm">
            <h2 class="text-2xl font-semibold mb-6 text-center text-magenta-400 neon-text-magenta">ADICIONAR CONQUISTA</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-1">
                    <label for="student-select" class="block text-sm font-medium text-cyan-300 mb-1">ALUNO(A):</label>
                    <select id="student-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base rounded-md"></select>
                </div>
                <div class="md:col-span-1">
                    <label for="badge-select" class="block text-sm font-medium text-cyan-300 mb-1">CONQUISTA:</label>
                    <select id="badge-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base rounded-md"></select>
                </div>
                <div class="md:col-span-1 flex items-end">
                    <button id="add-badge-btn" class="w-full font-bold py-2 px-4 rounded-md transition-all duration-300">
                        PREMIAR!
                    </button>
                </div>
            </div>
            <p id="feedback-message" class="text-center text-cyan-400 mt-4 h-5"></p>
        </div>

        <!-- O Mural de Conquistas -->
        <main id="mural" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            <!-- Os cards das conquistas serão inseridos aqui pelo JavaScript -->
        </main>

    </div>

    <script>
        // --- CONFIGURAÇÕES ---
        const ADMIN_PASSWORD = "salinas2025"; // Você pode mudar a senha aqui
        
        // Credenciais do seu JSONBin.io
        const JSONBIN_API_KEY = "$2a$10$6CtPJpqy4GU0j0jRdhjTJ.llBmCKg9UcINOVmbrOqUE740xZgleei";
        const JSONBIN_BIN_ID = "68a1f5cbd0ea881f405b8dff";

        // --- DADOS ESTÁTICOS ---
        const badges = {
            'historiador': { name: 'Historiador(a) Investigativo(a)', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_1o0oh11o0oh11o0o.png' },
            'viajante': { name: 'Viajante do Tempo', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_23uuf123uuf123uu.png' },
            'debate': { name: 'Guardião/Guardiã do Debate', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_3od0ct3od0ct3od0.png' },
            'conexoes': { name: 'Mestre das Conexões', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_7fue387fue387fue.png' },
            'leitor': { name: 'Leitor(a) Voraz', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_8rl7cd8rl7cd8rl7.png' },
            'critico': { name: 'Crítico(a) Literário(a)', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_dkxxrpdkxxrpdkxx.png' },
            'poeta': { name: 'Poeta Revelação', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_gu9j15gu9j15gu9j.png' },
            'arquiteto': { name: 'Arquiteto(a) de Mundos', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_iv4loriv4loriv4l.png' },
            'palavras': { name: 'Mestre das Palavras', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_oe7724oe7724oe77.png' },
            'revisor': { name: 'Revisor(a) Implacável', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_pal527pal527pal5.png' },
            'contador': { name: 'Contador(a) de Histórias', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_par0fppar0fppar0.png' },
            'argumento': { name: 'Poder do Argumento', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_rntrmmrntrmmrntr.png' },
            'colaborador': { name: 'Colaborador(a) Incrível', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_uo499wuo499wuo49.png' },
            'persistencia': { name: 'Mestre da Persistência', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_wts3jewts3jewts3.png' },
            'digital': { name: 'Entusiasta Digital', url: 'https://oda.nekoweb.org/badges/Gemini_Generated_Image_yg4ur4yg4ur4yg4u.png' },
        };

        // --- LÓGICA DA APLICAÇÃO ---
        let students = []; // Esta variável será preenchida com os dados do JSONBin

        const muralContainer = document.getElementById('mural');
        const studentSelect = document.getElementById('student-select');
        const badgeSelect = document.getElementById('badge-select');
        const addBadgeBtn = document.getElementById('add-badge-btn');
        const feedbackMessage = document.getElementById('feedback-message');
        const adminPanel = document.getElementById('admin-panel');
        const adminLoginBtn = document.getElementById('admin-login-btn');

        // Função para buscar os dados no JSONBin
        async function fetchData() {
            try {
                muralContainer.innerHTML = `<p class="text-cyan-400 text-center col-span-full">CARREGANDO DADOS DA TURMA...</p>`;
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': JSONBIN_API_KEY }
                });
                if (!response.ok) throw new Error('Falha ao buscar dados.');
                const data = await response.json();
                students = data.record; // Pega os dados dos alunos do "record"
                populateSelects();
                renderMural();
            } catch (error) {
                muralContainer.innerHTML = `<p class="text-red-500 text-center col-span-full">${error.message} Verifique as chaves no código.</p>`;
            }
        }

        // Função para atualizar os dados no JSONBin
        async function updateData() {
            try {
                feedbackMessage.textContent = 'SALVANDO...';
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify(students)
                });
                if (!response.ok) throw new Error('Falha ao salvar dados.');
                feedbackMessage.textContent = 'Salvo com sucesso!';
                setTimeout(() => { feedbackMessage.textContent = ''; }, 3000);
            } catch (error) {
                feedbackMessage.textContent = error.message;
                feedbackMessage.className = 'text-center text-red-500 mt-4 h-5';
            }
        }

        function showAdminPanel() {
            const password = prompt("Digite a senha de acesso:");
            if (password === ADMIN_PASSWORD) {
                adminPanel.classList.remove('hidden');
                adminLoginBtn.classList.add('hidden');
            } else if (password) {
                alert("Senha incorreta.");
            }
        }

        adminLoginBtn.addEventListener('click', showAdminPanel);
        
        function renderMural() {
            muralContainer.innerHTML = '';
            for (const badgeKey in badges) {
                const badge = badges[badgeKey];
                const winners = students.filter(student => student.badges.includes(badgeKey));
                const card = document.createElement('div');
                card.className = 'badge-card rounded-lg p-4 flex flex-col items-center text-center';
                
                let winnersHtml = winners.length > 0 ? winners.map(winner => `
                    <div class="flex items-center space-x-2 bg-gray-900/50 rounded-full pr-3">
                        <img src="${winner.avatar}" alt="${winner.name}" class="w-6 h-6 rounded-full border-2 border-cyan-400">
                        <span class="text-sm">${winner.name}</span>
                    </div>
                `).join('') : `<p class="text-sm text-violet-300 italic">Aguardando um herói!</p>`;

                card.innerHTML = `
                    <img src="${badge.url}" alt="${badge.name}" class="badge-main-img w-32 h-32 mb-4">
                    <h3 class="text-lg font-semibold text-cyan-300 h-14 flex items-center justify-center">${badge.name}</h3>
                    <div class="w-full h-px bg-violet-700 my-3"></div>
                    <div class="flex flex-col items-center gap-2 w-full min-h-[80px]">
                        ${winnersHtml}
                    </div>
                `;
                muralContainer.appendChild(card);
            }
        }

        function populateSelects() {
            studentSelect.innerHTML = '';
            badgeSelect.innerHTML = '';
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                studentSelect.appendChild(option);
            });
            for (const key in badges) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = badges[key].name;
                badgeSelect.appendChild(option);
            }
        }

        function handleAddBadge() {
            const studentId = parseInt(studentSelect.value);
            const badgeKey = badgeSelect.value;
            const student = students.find(s => s.id === studentId);

            if (student && badgeKey) {
                if (!student.badges.includes(badgeKey)) {
                    student.badges.push(badgeKey);
                    renderMural();
                    updateData(); // Salva a mudança online
                } else {
                    feedbackMessage.textContent = `${student.name.toUpperCase()} JÁ POSSUI ESTA CONQUISTA.`;
                    feedbackMessage.className = 'text-center text-yellow-400 mt-4 h-5';
                    setTimeout(() => { feedbackMessage.textContent = ''; }, 3000);
                }
            }
        }
        
        addBadgeBtn.addEventListener('click', handleAddBadge);

        document.addEventListener('DOMContentLoaded', () => {
            fetchData(); // Inicia a página buscando os dados online
        });
    </script>
</body>
</html>
